---
name: building-task-prompts
description: サブエージェント用プロンプトの構築と結果フォーマットの標準化。「プロンプトを作って」「サブエージェント用のプロンプト」と言われた時、または他のスキル/コマンドから呼び出された時に使用。
---

# Building Task Prompts

サブエージェント用の効果的なプロンプトを構築し、結果フォーマットを標準化する。

## 責務

1. **タスクタイプの判定** - 指示を分析して適切なタイプを決定
2. **プロンプト生成** - タスクタイプに応じた構造化プロンプトを生成
3. **報告フォーマット指定** - 一貫した結果を受け取れる形式を提供
4. **コンテキスト効率化** - 結果サイズを制御しメインコンテキストを節約

## タスクタイプ判定

| タイプ | 判定キーワード |
|--------|---------------|
| `research-web` | 調査、比較、最新、ベストプラクティス、ライブラリ選定 |
| `research-code` | 既存実装、パターン確認、コードベース、どう実装されている |
| `implement` | 実装、作成、追加、開発、を作る、を書く |
| `build` | ビルド、コンパイル、実行 |
| `test` | テスト、検証、カバレッジ |
| `review` | レビュー、確認、品質チェック |

## プロンプト構造

すべてのプロンプトは以下の構造：

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: <タスク説明>

## 目的
<具体的な目標>

## 実行内容
<詳細な指示>

## 期待する成果物
- <成果物1>
- <成果物2>

## 報告フォーマット
<タスクタイプ別の形式>
```

## タスクタイプ別テンプレート

### research-web

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: {topic}についてWeb調査

## 目的
{purpose}

## 調査内容
- 検索キーワード: {keywords}
- 調査観点:
  - 最新性（2024年以降）
  - 実績・採用事例
  - ドキュメントの充実度

## 期待する成果物
- 調査結果のサマリー
- 選択肢の比較表
- 推奨案と理由

## 報告フォーマット
### サマリー
<3-5行で要約>

### 調査結果
#### 選択肢1: <名前>
- 概要: <説明>
- メリット: <リスト>
- デメリット: <リスト>
- 参照: <URL>

### 比較表
| 項目 | 選択肢1 | 選択肢2 |
|------|---------|---------|

### 推奨案
<推奨と理由>

### 参照情報
- <URL一覧>
```

### research-code

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: {target}についてコードベース調査

## 目的
{purpose}

## 調査範囲
- 対象ディレクトリ: {scope}
- 除外: node_modules/, dist/

## 調査観点
- 既存の実装パターン
- 使用ライブラリ
- 命名規則

## 期待する成果物
- 既存実装の概要
- 主要パターン
- 新規実装への示唆

## 報告フォーマット
### サマリー
<3-5行で要約>

### 既存実装の概要
- ファイル構成
- 主要コンポーネント

### 発見したパターン
#### パターン1: <名前>
- 場所: <ファイルパス:行番号>
- 説明: <内容>

### 新規実装への示唆
- <示唆リスト>

### 参照ファイル
- <ファイルパス一覧>
```

### implement

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: {feature}の実装

## 目的
{purpose}

## 前提情報
{context}

## 実装要件
{requirements}

## 制約条件
- 既存のコーディング規約に従う
- 型安全性を維持

## 期待する成果物
- 実装コード
- 変更ファイル一覧
- 実装判断の記録

## 報告フォーマット
### サマリー
<3-5行で要約>

### 変更ファイル一覧
| ファイル | 変更種別 | 概要 |
|----------|----------|------|

### 実装詳細
#### <ファイル>
- 変更内容: <説明>
- 判断理由: <理由>

### 動作確認
- <確認項目>: <結果>

### 残課題・注意点
- <課題があれば>
```

### build

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: プロジェクトのビルド実行

## 目的
{purpose}

## ビルド情報
- プロジェクトパス: {path}
- ビルドコマンド: {command}

## エラー時の対応
- エラー内容を分析
- 修正案を提示
- 自動修正可能なら実行

## 報告フォーマット
### サマリー
<ビルド結果要約>

### ビルド結果
- 状態: 成功/失敗
- 所要時間: XX秒
- 警告数: X件
- エラー数: X件

### エラー詳細（あれば）
#### エラー1
- ファイル: <パス>
- 内容: <メッセージ>
- 修正案: <提案>

### 次のアクション
- <推奨アクション>
```

### test

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: テストの実行

## 目的
{purpose}

## テスト情報
- テストコマンド: {command}
- 対象範囲: {scope}

## 失敗時の対応
- 失敗原因を分析
- 修正案を提示

## 報告フォーマット
### サマリー
<テスト結果要約>

### テスト結果
- 状態: 成功/失敗
- 総テスト数: X
- 成功: X
- 失敗: X

### 失敗テスト詳細（あれば）
#### テスト: <名前>
- 期待値: <期待>
- 実際値: <実際>
- 修正案: <提案>

### 次のアクション
- <推奨アクション>
```

### review

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: コードレビュー

## 目的
{purpose}

## レビュー対象
- 対象: {target}
- 範囲: {scope}

## レビュー観点
- コード品質
- ロジックの正確性
- エラーハンドリング
- パフォーマンス
- セキュリティ

## 報告フォーマット
### サマリー
<レビュー結果要約>

### 総合評価
- 承認可否: 承認/要修正
- 品質スコア: X/10

### 指摘事項

#### 必須修正（Must Fix）
##### 指摘1
- ファイル: <パス:行番号>
- 種別: <バグ/セキュリティ等>
- 内容: <指摘>
- 修正案: <提案>

#### 推奨修正（Should Fix）
- <指摘リスト>

### 良い点
- <良い点リスト>

### 次のアクション
- <推奨アクション>
```

## 使用例

### 入力
「Reactのフォーム管理ライブラリについて調査して」

### 出力（生成されるプロンプト）
```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: Reactのフォーム管理ライブラリについてWeb調査

## 目的
新規フォーム実装に最適なライブラリを選定する

## 調査内容
- 検索キーワード: React form library 2024, React Hook Form, Formik
- 調査観点:
  - 最新性（2024年以降）
  - 実績・採用事例
  - ドキュメントの充実度
  - TypeScriptサポート

## 期待する成果物
- 主要ライブラリの比較
- 推奨案と理由

## 報告フォーマット
[research-webフォーマット]
```

## コンテキスト効率化ルール

サブエージェントの結果がメインコンテキストを圧迫しないよう、以下のルールを適用する。

### 結果サイズの制御

すべてのサブエージェントプロンプトに以下を含める：

```
## 結果の返し方（重要）

1. **サマリー必須**（3-5行で完結）
2. **主要ポイント**（最大5項目、各1-2行）
3. **詳細データの扱い**
   - 大量のログ/コード/調査結果 → `.claude/tmp/`に保存
   - 結果には「詳細: `.claude/tmp/task-xxx.md` 参照」と記載
   - ファイル名は内容がわかる形式（例: `task-auth-research.md`）
4. **ネクストアクション**
   - 追加分析や詳細確認が必要な場合は明示
   - 「〜が必要な場合は別途Taskで実行」と提案
```

### 詳細保存の判断基準

以下の場合は詳細をファイルに保存し、サマリーのみ返す：

| 対象 | 保存基準 |
|------|---------|
| ビルド/テストログ | 10行以上 |
| コード差分 | 50行以上 |
| 調査結果 | 比較対象3つ以上 |
| エラー詳細 | スタックトレース含む |

### ネクストアクションのパターン

サブエージェントからサブエージェントは呼び出せないため、追加処理が必要な場合は以下の形式で提案：

```
### ネクストアクション
- [ ] 詳細確認が必要: `.claude/tmp/xxx.md`を読み込んで分析
- [ ] 追加調査が必要: 「〇〇について調査」でTask起動
- [ ] 実装に進む: 「〇〇を実装」でTask起動
```

## ベストプラクティス

1. **明確性** - 目的を具体的に、曖昧な表現を避ける
2. **構造化** - 一貫したフォーマット、セクションを明確に
3. **完全性** - 必要な情報をすべて含める
4. **実行可能性** - 具体的なアクションを指示
5. **簡潔性** - メインコンテキストに返す情報は最小限に
