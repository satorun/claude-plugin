---
name: building-task-prompts
description: サブエージェント用プロンプトの構築と結果フォーマットの標準化。「プロンプトを作って」「サブエージェント用のプロンプト」と言われた時、または他のスキル/コマンドから呼び出された時に使用。
---

# Building Task Prompts

サブエージェント用の効果的なプロンプトを構築し、結果フォーマットを標準化する。

## 責務

1. **タスクタイプの判定** - 指示を分析して適切なタイプを決定
2. **プロンプト生成** - タスクタイプに応じた構造化プロンプトを生成
3. **報告フォーマット指定** - 一貫した結果を受け取れる形式を提供
4. **コンテキスト効率化** - 結果サイズを制御しメインコンテキストを節約

## タスクタイプ判定

| タイプ | 判定キーワード | テンプレート |
|--------|---------------|--------------|
| `research-web` | 調査、比較、最新、ベストプラクティス、ライブラリ選定 | `templates/research-web.md` |
| `research-code` | 既存実装、パターン確認、コードベース、どう実装されている | `templates/research-code.md` |
| `implement` | 実装、作成、追加、開発、を作る、を書く | `templates/implement.md` |
| `build` | ビルド、コンパイル、実行 | `templates/build.md` |
| `test` | テスト、検証、カバレッジ | `templates/test.md` |
| `review` | レビュー、確認、品質チェック | `templates/review.md` |

## ワークフロー

1. **タスクタイプを判定** - 上記キーワードに基づいて判定
2. **該当テンプレートを読み込み** - `templates/{type}.md` を読み込む
3. **変数を埋めてプロンプト生成** - `{topic}`, `{purpose}` 等を置換
4. **コンテキスト効率化ルールを付加** - 下記ルールをプロンプトに追加

## プロンプト構造

すべてのプロンプトは以下の構造：

```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: <タスク説明>

## 目的
<具体的な目標>

## 実行内容
<詳細な指示>

## 期待する成果物
- <成果物1>
- <成果物2>

## 報告フォーマット
<タスクタイプ別の形式>
```

## 使用例

### 入力
「Reactのフォーム管理ライブラリについて調査して」

### 処理
1. キーワード「調査」→ タイプ `research-web` と判定
2. `templates/research-web.md` を読み込み
3. 変数を埋めてプロンプト生成

### 出力（生成されるプロンプト）
```
[ULTRATHINK MODE - 深く検討して実行してください]

タスク: Reactのフォーム管理ライブラリについてWeb調査

## 目的
新規フォーム実装に最適なライブラリを選定する

## 調査内容
- 検索キーワード: React form library 2024, React Hook Form, Formik
- 調査観点:
  - 最新性（2024年以降）
  - 実績・採用事例
  - ドキュメントの充実度
  - TypeScriptサポート

## 期待する成果物
- 主要ライブラリの比較
- 推奨案と理由

## 報告フォーマット
[research-webフォーマット]
```

## コンテキスト効率化ルール

サブエージェントの結果がメインコンテキストを圧迫しないよう、以下のルールを適用する。

### 結果サイズの制御

すべてのサブエージェントプロンプトに以下を含める：

```
## 結果の返し方（重要）

1. **サマリー必須**（3-5行で完結）
2. **主要ポイント**（最大5項目、各1-2行）
3. **詳細データの扱い**
   - 大量のログ/コード/調査結果 → `.claude/tmp/`に保存
   - 結果には「詳細: `.claude/tmp/task-xxx.md` 参照」と記載
   - ファイル名は内容がわかる形式（例: `task-auth-research.md`）
4. **ネクストアクション**
   - 追加分析や詳細確認が必要な場合は明示
   - 「〜が必要な場合は別途Taskで実行」と提案
```

### 詳細保存の判断基準

以下の場合は詳細をファイルに保存し、サマリーのみ返す：

| 対象 | 保存基準 |
|------|---------|
| ビルド/テストログ | 10行以上 |
| コード差分 | 50行以上 |
| 調査結果 | 比較対象3つ以上 |
| エラー詳細 | スタックトレース含む |

### ネクストアクションのパターン

サブエージェントからサブエージェントは呼び出せないため、追加処理が必要な場合は以下の形式で提案：

```
### ネクストアクション
- [ ] 詳細確認が必要: `.claude/tmp/xxx.md`を読み込んで分析
- [ ] 追加調査が必要: 「〇〇について調査」でTask起動
- [ ] 実装に進む: 「〇〇を実装」でTask起動
```

## ベストプラクティス

1. **明確性** - 目的を具体的に、曖昧な表現を避ける
2. **構造化** - 一貫したフォーマット、セクションを明確に
3. **完全性** - 必要な情報をすべて含める
4. **実行可能性** - 具体的なアクションを指示
5. **簡潔性** - メインコンテキストに返す情報は最小限に
